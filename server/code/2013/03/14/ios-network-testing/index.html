
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>iOS Network Testing</title>
    <meta name="description" content="">
    <meta name="author" content="superdude">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">HackaZach;</a>
          <ul class="nav">
            <li>  <a href="/about.html">About Zach</a> </li>
            <li> <a href="/posts.html">All Posts</a></li>
            <li><a href="/tags.html">Tags</a> </li>
            <li><a href="/categories.html">Categories</a> </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        
<div class="page-header">
  <h1>iOS Network Testing </h1>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>14 March 2013</strong>
    </div>
    <div class="content">
      <p><a href='http://hackazach.net/post/44988952817/ios-network-testing' title='Permalink to HackaZach; • iOS Network Testing'>Permalink</a></p>

<p>During development of an API client, do you require VPN connectivity to hit web service? Is a network service your app relies on a little less than completely reliable? oh and each network error handler has been tested to ensure things keep working, right? Yeah - Maybe not. Network testing can be a real pain in the ass. The aim of this article is to lower the aching pain in your backside while testing iOS apps; and to hopefully make it a part of normal workflow.</p>

<p>This article contains a sample walk-through of testing an imaginary web service with ILTesting, AFNetworking and Kiwi. It’s assumed the reader is familiar with the basics of Cocoa Touch, XCode and project creation.</p>

<p>If you’re a solid iOS dev but not familiar with Kiwi or AFnetworking, please check them out:</p>

<p><a href='https://github.com/allending/Kiwi/wiki/Guide:-Up-and-Running-with-Kiwi' title='Kiwi'>Kiwi</a></p>

<p><a href='https://github.com/AFNetworking/AFNetworking'>AFNetworking</a></p>

<p>It should be noted the approach shown using ILTesting will work with most any testing framework or networking library on iOS.</p>

<p><strong>Example DogPark Application</strong></p>

<p>The example application repo is located here on Github: <a href='https://github.com/zmcartor/DogPark-ILTesting'>DogPark</a></p>

<p>In our example application, we’ll be testing an implementation of an imaginary Dog Park API client. The client sends requests over HTTP and presently has two methods:</p>

<p>We’ll get to the fun of testing a Dog Park API soon, but first a little about the network testing library we’ll be using.</p>

<p><strong>Intro To ILTesting (<a href='https://github.com/zmcartor/ILTesting'>GitHub</a>)</strong></p>

<p>The magic behind ILTesting is simple: it ingeniously registers itself as an NSURLPrototcol handler thereby getting “first dibs” to handle HTTP requests from the application. (A more technically in-depth article on NSURLProtocol is available here : <a href='http://nshipster.com/nsurlprotocol/'>NSHipster</a> .)</p>

<p>The registration of a pre-defined HTTP handler effectively keeps our app from hitting the network. (This speeds up our tests!) But the main point is predictively crafting an HTTP response for a given URL.</p>

<p>(If you’re wondering ‘why not just mock AFNetworking instead’, I shy away from mocking code that I did not write myself.)</p>

<p>Let’s take a look at a couple ILTesting class methods:</p>

<p><strong>The ILTesting Delegate</strong></p>

<p>ILTesting allows for delegation of client response data to a class which implements the protocol.</p>

<p>The protocol-delegate protocol looks like this and includes several optional methods:</p>

<p>Within the sample application, the delegate is implemented in HKZFakeWebsServer.</p>

<p>A tip for dealing with large APIs is to have several different classes each implement CannedURLProtocol and break up response testing between various functional areas. Ex - billing, user authentication, etc.</p>

<p>Enough stuffy code talk, let’s get going and have some fun!</p>

<p><strong>Back to the DogPark</strong></p>

<p><strong><img alt='image' src='http://media.tumblr.com/547a729f43c4bddfcc8603571dc8ecb9/tumblr_inline_mjfb450f2O1qz4rgp.jpg' /></strong></p>

<p>So anyway, we need to test our example APIClient methods. When beginning network testing, this process has proved successful:</p>

<ol>
<li>
<p>Capture the desired JSON response from the API and save it within a file. (In the sample application, these are kept within the DogParkTests/JSON folder.</p>
</li>

<li>
<p>Create a trigger within the ILTesting delegate to serve the response.</p>
</li>

<li>
<p>Write a test which utilizes the response.</p>
</li>
</ol>

<p>Take a look at HKZFakeWebserver which implements ‘<em>responseDataForClient’</em> which is self explanitory ;) - it loads various JSON files as response data when specific URLs are requested. The request is matched on HTTP verb and path.</p>

<p><strong>Taking things further - Completing the implementation</strong></p>

<p>Within the sample application, both tests presently fail. I leave the implementation of the client to the reader as an exercise in using ILTesting. The example code also serves as a reference to employ this testing method in your own project.</p>

<p>Happy testing!</p>

<p>References:<br /><a href='https://github.com/allending/Kiwi/wiki/Guide:-Up-and-Running-with-Kiwi' title='Kiwi'>1</a> Credit for the original idea of injecting test data via NSURLProtocol goes to Claus Broch : <a href='http://www.infinite-loop.dk'>www.infinite-loop.dk</a></p>
    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
     
    	<li><a href="/categories.html#code-ref">
    		code <span>2</span>
    	</a></li>
    
  


    </ul>
    

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#ios-ref">ios <span>1</span></a></li>
     
    	<li><a href="/tags.html#testing-ref">testing <span>1</span></a></li>
    
  



    </ul>
    

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev disabled"><a>&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/code/2013/03/16/coffeescript-and-qr-codes" title="Coffeescript and QR Codes">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    




  </div>
</div>

      </div>
      <hr>
      <footer>
        <p>&copy; 2013 superdude
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div>

    
  </body>
</html>

